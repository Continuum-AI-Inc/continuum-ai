function t(t,e,i=5184e6){const n=new Date;n.setTime(n.getTime()+i);let o="expires="+n.toUTCString();document.cookie=t+"="+e+";"+o+";path=/"}var e=function(t,e,i,n){return new(i||(i=Promise))((function(o,s){function u(t){try{a(n.next(t))}catch(t){s(t)}}function c(t){try{a(n.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(u,c)}a((n=n.apply(t,e||[])).next())}))};const i={status:"unknown",auth_response:{app_id:"",user_id:""}},n=new EventTarget;class Continuum{static initButtons(){return e(this,void 0,void 0,(function*(){let t=Array.from(document.querySelectorAll(".continuum-login-button")),i=yield this.getLoginStatus();for(let o of t){let t=document.createElement("button");t.classList.add("continuum-login-button");let s=document.createElement("img");s.src="https://continuum-ai.de/favicon.ico",s.classList.add("continuum-login-button-logo"),t.innerText="Login With Continuum",t.prepend(s);let u="rounded"==o.getAttribute("data-layout"),c=o.getAttribute("data-size");if(u&&(t.setAttribute("data-layout",o.getAttribute("data-layout")),t.classList.add("rounded")),c&&(t.setAttribute("data-size",c),t.classList.add(c)),t.setAttribute("data-scope",o.getAttribute("data-scope")),"connected"==i.status){let e=yield this.api(`/v1/user/lookup/?id=${i.auth_response.user_id}`);"sign_out"==this.logged_in_click_behavior?t.innerText="Logout":t.innerText=i18n_WELCOME_BACK+`, ${e.data.username}`,t.prepend(s)}t.addEventListener("click",(()=>e(this,void 0,void 0,(function*(){if(!this.client_key)throw new Error("Undefined app id.");if(this.user_id&&"sign_out"==this.logged_in_click_behavior){this.user_id="";const e=new CustomEvent("logout",{detail:{status:"unknown",auth_response:{app_id:this.client_key,user_id:this.user_id}}});return n.dispatchEvent(e),this.use_cookie&&(t=this.cookie_name,document.cookie=t+"=;path=/;Max-Age=0;"),void this.initButtons()}var t;let e=o.getAttribute("data-scope"),i={};e.split(",").forEach((t=>{i[t.trim()]=!0})),yield this.login(i)})))),o.replaceWith(t)}}))}static login(i={}){return e(this,void 0,void 0,(function*(){i=Object.assign({public_profile:!0,email:!1,name:!1,residence:!1},i);let e=Object.entries(i).filter(((t,e)=>e)).map((t=>t[0])).join(",");return new Promise(((i,o)=>{let s=screen.width/2-300,u=screen.height/2-400;window.open(`https://link.continuum-ai.de/connect/?client_key=${this.client_key}&scope=${e}`,"_blank",`width=600,height=800,left=${s},top=${u}`)||o("Failed opening handle. Connection could not be established."),window.onmessage=e=>{const o=e.data;if("connected"!==o.status)return;this.use_cookie&&t(this.cookie_name,o.auth_response.user_id),this.user_id=o.auth_response.user_id,this.initButtons();const s=new CustomEvent("login",{detail:o});n.dispatchEvent(s),i(o)}}))}))}static logout(){return e(this,void 0,void 0,(function*(){this.use_cookie&&t(this.cookie_name,"",-1);const e=new CustomEvent("logout",{detail:{status:"unknown",auth_response:{app_id:this.client_key,user_id:this.user_id}}});n.dispatchEvent(e)}))}static on(t,e){n.addEventListener(t,e)}static init(t){const{client_key:e,cookie:i,click_behavior:n,user_id:o,cookie_name:s,default_style:u}=Object.assign({client_key:"",cookie:!0,click_behavior:"sign_out",user_id:"",cookie_name:"__continuum_client_id",default_style:!0});if(!e)throw new Error("Missing client_key in init.");if(this.client_key=e,this.use_cookie=i,this.user_id=o,this.cookie_name=s||"__continuum_client_id",u){const t=document.createElement("style");t.textContent=".continuum-login-button{padding:8px 16px;display:flex;flex-direction:row;gap:10px;align-items:center;font-size:14px;font-weight:600;cursor:pointer;border-radius:4px;border:1px solid #333;background-color:#fff;transition:background-color .2s}.continuum-login-button .continuum-login-button-logo{width:20px;height:20px}.continuum-login-button:hover{background-color:#eee}.continuum-login-button:active{background-color:#ddd}.continuum-login-button.rounded{border-radius:36px}.continuum-login-button.small{font-size:12px;padding:6px 12px}.continuum-login-button.small .continuum-login-button-logo{width:18px;height:18px}.continuum-login-button.medium{padding:8px 16px}.continuum-login-button.large{font-size:16px;padding:12px 24px;gap:16px}.continuum-login-button.large .continuum-login-button-logo{width:25px;height:25px}",document.head.appendChild(t)}!this.user_id&&this.use_cookie&&(this.user_id=function(t){t+="=";let e=decodeURIComponent(document.cookie).split(";");for(let i=0;i<e.length;i++){let n=e[i];for(;" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return""}(this.cookie_name)),this.logged_in_click_behavior=n,this.initButtons()}static getLoginStatus(){return e(this,void 0,void 0,(function*(){return new Promise(((t,n)=>e(this,void 0,void 0,(function*(){if(this.user_id){const e=yield this.api(`/v1/link/validate/?user_id=${this.user_id}&client_key=${this.client_key}`);e&&t(e)}else t(i)}))))}))}static api(t,i=null,n="GET"){return e(this,void 0,void 0,(function*(){return new Promise(((e,o)=>{t="https://api.continuum-ai.de"+t;const s=new XMLHttpRequest;s.onreadystatechange=function(t){if(4===this.readyState&&200===this.status){let t=JSON.parse(this.responseText);e(t)}else 4===this.readyState&&200!==this.status&&o()},s.open(n,t,!0),s.setRequestHeader("Content-Type","application/json;charset=UTF-8"),s.send(i)}))}))}}Continuum.client_key="",Continuum.user_id="",Continuum.cookie_name="",Continuum.use_cookie=!0,Continuum.logged_in_click_behavior="open_popup";export{Continuum as default};
